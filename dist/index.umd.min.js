!(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? t(exports, require('react'))
    : 'function' == typeof define && define.amd
    ? define(['exports', 'react'], t)
    : t(
        ((e =
          'undefined' != typeof globalThis
            ? globalThis
            : e || self).reactSliderVertify = {}),
        e.React,
      );
})(this, function (e, t) {
  'use strict';
  function n(e) {
    return e && 'object' == typeof e && 'default' in e ? e : { default: e };
  }
  var r = n(t);
  function o(e) {
    return e &&
      e.__esModule &&
      Object.prototype.hasOwnProperty.call(e, 'default')
      ? e.default
      : e;
  }
  function i(e, t, n) {
    return (
      e(
        (n = {
          path: t,
          exports: {},
          require: function (e, t) {
            return (function () {
              throw Error(
                'Dynamic requires are not currently supported by @rollup/plugin-commonjs',
              );
            })();
          },
        }),
        n.exports,
      ),
      n.exports
    );
  }
  var u = i(function (e) {
      (e.exports = function (e) {
        if (Array.isArray(e)) return e;
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    a = i(function (e) {
      (e.exports = function (e, t) {
        var n =
          null == e
            ? null
            : ('undefined' != typeof Symbol && e[Symbol.iterator]) ||
              e['@@iterator'];
        if (null != n) {
          var r,
            o,
            i = [],
            u = !0,
            a = !1;
          try {
            for (
              n = n.call(e);
              !(u = (r = n.next()).done) &&
              (i.push(r.value), !t || i.length !== t);
              u = !0
            );
          } catch (e) {
            (a = !0), (o = e);
          } finally {
            try {
              u || null == n.return || n.return();
            } finally {
              if (a) throw o;
            }
          }
          return i;
        }
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    c = i(function (e) {
      (e.exports = function (e, t) {
        (null == t || t > e.length) && (t = e.length);
        for (var n = 0, r = Array(t); t > n; n++) r[n] = e[n];
        return r;
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    l = i(function (e) {
      (e.exports = function (e, t) {
        if (e) {
          if ('string' == typeof e) return c(e, t);
          var n = Object.prototype.toString.call(e).slice(8, -1);
          return (
            'Object' === n && e.constructor && (n = e.constructor.name),
            'Map' === n || 'Set' === n
              ? Array.from(e)
              : 'Arguments' === n ||
                /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
              ? c(e, t)
              : void 0
          );
        }
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    s = i(function (e) {
      (e.exports = function () {
        throw new TypeError(
          'Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.',
        );
      }),
        (e.exports.default = e.exports),
        (e.exports.__esModule = !0);
    }),
    d = o(
      i(function (e) {
        (e.exports = function (e, t) {
          return u(e) || a(e, t) || l(e, t) || s();
        }),
          (e.exports.default = e.exports),
          (e.exports.__esModule = !0);
      }),
    );
  function f(e, t) {
    return Math.round(Math.random() * (t - e) + e);
  }
  function p(e, t) {
    return e + t;
  }
  function h(e) {
    return e * e;
  }
  (e.Vertify = t.memo(function (e) {
    var n = e.width,
      o = void 0 === n ? 320 : n,
      i = e.height,
      u = void 0 === i ? 160 : i,
      a = e.l,
      c = void 0 === a ? 42 : a,
      l = e.r,
      s = void 0 === l ? 9 : l,
      m = e.imgUrl,
      v = e.text,
      y = e.refreshIcon,
      x = void 0 === y ? 'http://cdn.dooring.cn/dr/icon12.png' : y,
      g = e.visible,
      b = void 0 === g || g,
      w = e.onSuccess,
      M = e.onFail,
      _ = e.onRefresh,
      C = t.useState(!1),
      E = d(C, 2),
      S = E[0],
      T = E[1],
      R = t.useState(0),
      I = d(R, 2),
      N = I[0],
      A = I[1],
      j = t.useState('sliderContainer'),
      O = d(j, 2),
      D = O[0],
      X = O[1],
      k = t.useState(v),
      q = d(k, 2),
      P = q[0],
      U = q[1],
      Y = t.useRef(null),
      F = t.useRef(null),
      L = t.useRef(null),
      V = t.useRef(!1),
      W = t.useRef([]),
      G = t.useRef(0),
      H = t.useRef(0),
      $ = t.useRef(0),
      z = t.useRef(0),
      B = Math.PI,
      J = c + 2 * s + 3,
      K = function (e, t, n, r) {
        e.beginPath(),
          e.moveTo(t, n),
          e.arc(t + c / 2, n - s + 2, s, 0.72 * B, 2.26 * B),
          e.lineTo(t + c, n),
          e.arc(t + c + s - 2, n + c / 2, s, 1.21 * B, 2.78 * B),
          e.lineTo(t + c, n + c),
          e.lineTo(t, n + c),
          e.arc(t + s - 2, n + c / 2, s + 0.4, 2.76 * B, 1.24 * B, !0),
          e.lineTo(t, n),
          (e.lineWidth = 2),
          (e.fillStyle = 'rgba(255, 255, 255, 0.7)'),
          (e.strokeStyle = 'rgba(255, 255, 255, 0.7)'),
          e.stroke(),
          (e.globalCompositeOperation = 'destination-over'),
          'fill' === r ? e.fill() : e.clip();
      },
      Q = function () {
        return (
          m ||
          'https://picsum.photos/id/'
            .concat(f(0, 1084), '/')
            .concat(o, '/')
            .concat(u)
        );
      },
      Z = function () {
        var e = (function (e) {
          var t = new Image();
          return (
            (t.crossOrigin = 'Anonymous'),
            (t.onload = e),
            (t.onerror = function () {
              t.setSrc(Q());
            }),
            (t.setSrc = function (e) {
              if (window.navigator.userAgent.indexOf('Trident') > -1) {
                var n = new XMLHttpRequest();
                (n.onloadend = function (e) {
                  var n = new FileReader();
                  n.readAsDataURL(e.target.response),
                    (n.onloadend = function (e) {
                      var n;
                      t.src =
                        null == e || null === (n = e.target) || void 0 === n
                          ? void 0
                          : n.result;
                    });
                }),
                  n.open('GET', e),
                  (n.responseType = 'blob'),
                  n.send();
              } else t.src = e;
            }),
            t.setSrc(Q()),
            t
          );
        })(function () {
          T(!1),
            (function (e) {
              var t = Y.current.getContext('2d'),
                n = F.current.getContext('2d');
              ($.current = f(J + 10, o - (J + 10))),
                (z.current = f(10 + 2 * s, u - (J + 10))),
                K(t, $.current, z.current, 'fill'),
                K(n, $.current, z.current, 'clip'),
                t.drawImage(e, 0, 0, o, u),
                n.drawImage(e, 0, 0, o, u);
              var r = z.current - 2 * s - 1,
                i = n.getImageData($.current - 3, r, J, J);
              (F.current.width = J), n.putImageData(i, 0, r);
            })(e);
        });
        L.current = e;
      },
      ee = function () {
        var e = Y.current.getContext('2d'),
          t = F.current.getContext('2d');
        A(0),
          X('sliderContainer'),
          (F.current.width = o),
          (F.current.style.left = '0px'),
          e.clearRect(0, 0, o, u),
          t.clearRect(0, 0, o, u),
          T(!0),
          L.current.setSrc(Q());
      },
      te = function (e) {
        (G.current = e.clientX || e.touches[0].clientX),
          (H.current = e.clientY || e.touches[0].clientY),
          (V.current = !0);
      },
      ne = function (e) {
        if (!V.current) return !1;
        e.preventDefault();
        var t = (e.clientX || e.touches[0].clientX) - G.current,
          n = (e.clientY || e.touches[0].clientY) - H.current;
        if (0 > t || t + 38 >= o) return !1;
        A(t),
          (F.current.style.left = ((o - 40 - 20) / (o - 40)) * t + 'px'),
          X('sliderContainer sliderContainer_active'),
          W.current.push(n);
      },
      re = function (e) {
        if (!V.current) return !1;
        if (
          ((V.current = !1),
          (e.clientX || e.changedTouches[0].clientX) === G.current)
        )
          return !1;
        X('sliderContainer');
        var t,
          n,
          r,
          o,
          i =
            ((n = (t = W.current).reduce(p) / t.length),
            (r = t.map(function (e) {
              return e - n;
            })),
            (o = Math.sqrt(r.map(h).reduce(p) / t.length)),
            {
              spliced:
                10 > Math.abs(parseInt(F.current.style.left) - $.current),
              verified: 0 !== o,
            });
        i.spliced
          ? i.verified
            ? (X('sliderContainer sliderContainer_success'),
              'function' == typeof w && w())
            : (X('sliderContainer sliderContainer_fail'), U('请再试一次'), ee())
          : (X('sliderContainer sliderContainer_fail'),
            'function' == typeof M && M(),
            setTimeout(ee.bind(undefined), 1e3));
      };
    return (
      t.useEffect(
        function () {
          b && (L.current ? ee() : Z());
        },
        [b],
      ),
      r.default.createElement(
        'div',
        {
          className: 'vertifyWrap',
          style: {
            width: o + 'px',
            margin: '0 auto',
            display: b ? '' : 'none',
          },
          onMouseMove: ne,
          onMouseUp: re,
          onTouchMove: ne,
          onTouchEnd: re,
        },
        r.default.createElement(
          'div',
          { className: 'canvasArea' },
          r.default.createElement('canvas', { ref: Y, width: o, height: u }),
          r.default.createElement('canvas', {
            ref: F,
            className: 'block',
            width: o,
            height: u,
            onMouseDown: te,
            onTouchStart: te,
          }),
        ),
        r.default.createElement(
          'div',
          {
            className: D,
            style: { pointerEvents: S ? 'none' : 'auto', width: o + 'px' },
          },
          r.default.createElement(
            'div',
            { className: 'sliderMask', style: { width: N + 'px' } },
            r.default.createElement(
              'div',
              {
                className: 'slider',
                style: { left: N + 'px' },
                onMouseDown: te,
                onTouchStart: te,
              },
              r.default.createElement('div', { className: 'sliderIcon' }, '→'),
            ),
          ),
          r.default.createElement('div', { className: 'sliderText' }, P),
        ),
        r.default.createElement('div', {
          className: 'refreshIcon',
          onClick: function () {
            ee(), 'function' == typeof _ && _();
          },
          style: { backgroundImage: 'url('.concat(x, ')') },
        }),
        r.default.createElement(
          'div',
          {
            className: 'loadingContainer',
            style: {
              width: o + 'px',
              height: u + 'px',
              display: S ? '' : 'none',
            },
          },
          r.default.createElement('div', { className: 'loadingIcon' }),
          r.default.createElement('span', null, '加载中...'),
        ),
      )
    );
  })),
    Object.defineProperty(e, '__esModule', { value: !0 });
});
